<!DOCTYPE html>
<html  lang="en">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.1" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Hexo</title>


    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://yoursite.com/images/og_image.png">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/images/og_image.png">







<link rel="icon" href="/images/ylj.png">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">



</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.jpg" alt="Hexo" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item is-active"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/zzpzbl">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2021-11-21T13:29:07.000Z">2021-11-21</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/C/">C++</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 minutes read (About 1015 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2021/11/21/Gotw1/">Gotw1</a>
            
        </h1>
        <div class="content">
            <html><head></head><body><h2 id="C-有多少种初始化变量的方法"><a href="#C-有多少种初始化变量的方法" class="headerlink" title="C++ 有多少种初始化变量的方法"></a>C++ 有多少种初始化变量的方法</h2><p>四种：</p>
<ul>
<li>默认初始化</li>
<li>直接初始化</li>
<li>拷贝初始化</li>
<li>列表初始化</li>
</ul>
<h2 id="说下下面各行代码的含义"><a href="#说下下面各行代码的含义" class="headerlink" title="说下下面各行代码的含义"></a>说下下面各行代码的含义</h2><figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">widget w;                   <span class="hljs-comment">// (a)</span></span><br><span class="line"><span class="hljs-function">widget <span class="hljs-title">w</span><span class="hljs-params">()</span></span>;                 <span class="hljs-comment">// (b)</span></span><br><span class="line">widget w{};                 <span class="hljs-comment">// (c)</span></span><br><span class="line"><span class="hljs-function">widget <span class="hljs-title">w</span><span class="hljs-params">(x)</span></span>;                <span class="hljs-comment">// (d)</span></span><br><span class="line">widget w{x};                <span class="hljs-comment">// (e)</span></span><br><span class="line">widget w = x;               <span class="hljs-comment">// (f)</span></span><br><span class="line">widget w = {x};             <span class="hljs-comment">// (g)</span></span><br><span class="line"><span class="hljs-keyword">auto</span> w = x;                 <span class="hljs-comment">// (h)</span></span><br><span class="line"><span class="hljs-keyword">auto</span> w = widget{x};         <span class="hljs-comment">// (i)</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>(a)</code> 是默认初始化，调用的是 <code>default constructor widget::widget()</code><br><code>(b)</code> 是个陷阱，不是变量初始化，而是一个名为 <code>w</code> 返回 <code>widget</code> 类型且不接受参数的函数的声明，令人讨厌的事，这种形式很有可能形成歧义，例如下面的代码：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// same problem (gadget and doodad are types)</span></span><br><span class="line"><span class="hljs-comment">//</span></span><br><span class="line"><span class="hljs-function">widget <span class="hljs-title">w</span><span class="hljs-params">( gadget(), doodad() )</span></span>;  <span class="hljs-comment">// pitfall: not a variable declaration</span></span><br></pre></td></tr></tbody></table></figure>
<p>好消息是 <code>C++11</code> 解决了这个问题，通过提供一种几乎在所有情况下都取代 <code>case (b)</code> 的语法来解决这个问题，这样我们就不必再陷入这个坑了，答案就是 <code>case (c)</code><br><code>(c)</code> 是一种非常好的写法，它总是初始化变量，并且永远不会与函数声明产生歧义。<br><code>(d)</code> 和 <code>(e)</code> 都是直接初始化（假设 <code>x</code> 不是类型名）。二者都是通过 <code>widget::widget(x)</code>。如果 <code>x</code> 是 <code>widget</code> 类型，则调用拷贝构造函数，否则，将调用转换构造函数，注意到 <code>(e)</code> 创建了一个 <code>std::initializer_list</code>。如果 <code>widget</code> 有一个带 <code>initializer_list</code> 的构造函数，那么这个构造函数是首选； 否则，如果 <code>widget</code> 具有接受任何类型 <code>x</code> 的构造函数（可能带有转换），则使用该构造函数。<br>使用 <code>(e)</code> 有以下几个好处（相较于 <code>(d)</code>）：</p>
<ul>
<li>避免了歧义，因为 <code>(e)</code> 永远不可能是是一个函数声明</li>
<li>更安全，因为 <code>(e)</code> 不允许有损转换</li>
</ul>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">i1</span><span class="hljs-params">( <span class="hljs-number">12.345</span> )</span></span>;           <span class="hljs-comment">// ok: toss .345, we didn't like it anyway</span></span><br><span class="line"><span class="hljs-keyword">int</span> i2{ <span class="hljs-number">12.345</span> };           <span class="hljs-comment">// error: would be lossy implicit narrowing</span></span><br></pre></td></tr></tbody></table></figure>
<p><code>(f)</code> 和 <code>(g)</code> 分别是复制初始化和复制列表初始化<br>在 <code>(f)</code> 中，从概念上来讲，<code>w</code> 应该是通过拷贝构造函数或者移动构造函数初始化的，但必须纠正的一点是，不是出现的 <code>=</code> 就意味着调用的 <code>T::operator=</code>，它仍然是属于初始化而不是赋值。如果 <code>x</code> 是 <code>widget</code> 类型的，那么 <code>(f)</code> 和 <code>(d)</code> 是一样的，调用 <code>widget::widget(x);</code>（除了 <code>explicit ctor</code> 被调用）；如果 <code>x</code> 是其它类型，从概念上讲，编译器首先将 <code>x</code> 隐式转换为临时 <code>widget</code> 对象，然后从该临时右值移动构造 <code>w</code>，如果没有更好的移动构造函数，则使用复制构造作为“移动的缓慢方式”作为备份可用。假设隐式转换可用，<code>(f)</code> 的意思与 <code>widget w(widget(x));</code> 相同。<br><code>(g)</code> 被称之为 <code>copy-list-initialization</code>，含义和 <code>widget w{x}</code> 相同，但注意，<code>copy-list-initialization</code> 不会调用 <code>explicit ctor</code>，只有普通的构造函数才能被调用<br><code>(h)</code> 和 <code>(i)</code> 都是复制初始化，他们的语义和 <code>(f)</code> 和 <code>(g)</code> 相似，但更加简单，因为 <code>auto</code> 保证了右手表达式的类型将被准确推导出<br>Line (h) means the same as (d), type_of_x w(x);. Only a single copy constructor is called. This is guaranteed to stay true as the program evolves: Because line (h) does not commit to an explicit type, it is guaranteed to be both maximally efficient because there can be no conversion involved, and maximally robust under maintenance as the type of w “auto”-matically tracks the type of x which may change as the program is maintained.</p>
<p>Line (i) is the most consistent spelling when you do want to commit to a specific type and explicitly request a conversion if needed, and once again the { } syntax happily avoids lossy narrowing conversions. In practice on most compilers, only a single constructor is called—similarly to what we saw with (f) and (g), conceptually there are two constructor calls, a converting or copy constructor to create a temporary widget{x} followed by a move to move it to w, but compilers routinely elide the latter.</p>
<p>这两段话来自 <a href="https://herbsutter.com/2013/05/09/gotw-1-solution/，翻译起来很累。。。" target="_blank" rel="noopener">https://herbsutter.com/2013/05/09/gotw-1-solution/，翻译起来很累。。。</a></p>
</body></html>
        </div>
        
        
        
    </div>
</div>









    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2021-02-10T05:50:31.000Z">2021-02-10</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/artical/">artical</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    16 minutes read (About 2439 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2021/02/10/Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9Amap/">Redis数据类型：map</a>
            
        </h1>
        <div class="content">
            <html><head></head><body><h2 id="Redis-中的哈希表"><a href="#Redis-中的哈希表" class="headerlink" title="Redis 中的哈希表"></a>Redis 中的哈希表</h2><p>毫无疑问，哈希表是一种非常重要的数据结构，在做算法题时，我们也经常用到它来实现常数级别的访问，而 <code>Redis</code> 作为一种 <code>Key-Value</code> 的内存数据库，当然少不了哈希表的实现了。</p>
<h2 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h2><p>在 <code>Redis</code> 中，哈希表是基于链表实现的，首先看它在 <code>src/dic.h</code> 中定义的链表的节点结构：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dictEntry</span> {</span></span><br><span class="line">    <span class="hljs-keyword">void</span> * key;</span><br><span class="line">    <span class="hljs-keyword">union</span> {</span><br><span class="line">        <span class="hljs-keyword">void</span> * val;</span><br><span class="line">        <span class="hljs-keyword">uint64_t</span> u64;</span><br><span class="line">        <span class="hljs-keyword">int64_t</span> s64;</span><br><span class="line">        <span class="hljs-keyword">double</span> d;</span><br><span class="line">    } v;</span><br><span class="line">    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dictEntry</span> * <span class="hljs-title">next</span>;</span></span><br><span class="line">} dictEntry;</span><br></pre></td></tr></tbody></table></figure>

<p>我们可以看到，<code>value</code> 部分是使用一个 <code>union</code> 来表示的，查看 <code>union</code> 具体内容可以看到，<code>value</code> 类型可以是一个 64 位整数、双精度浮点数或者一段内存。</p>
<p>然后我们来看哈希表的结构：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dictht</span> {</span></span><br><span class="line">    dictEntry ** table;     <span class="hljs-comment">// table 是一个数组结构，每个元素都是一个 dictEntry 指针</span></span><br><span class="line">    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> size;     <span class="hljs-comment">// 哈希桶的数量</span></span><br><span class="line">    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> sizemask; <span class="hljs-comment">// 桶数量的掩码</span></span><br><span class="line">    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> used;     <span class="hljs-comment">// 已经使用的数量</span></span><br><span class="line">} dictht;</span><br></pre></td></tr></tbody></table></figure>

<p>上过算法与数据结构的小伙伴想必也很清楚，就像在一个数组（链表）中，每个节点又单独是一条链表，就像下面这样：</p>
<p><img src alt></p>
<p>图源：<img src="https://pic4.zhimg.com/v2-089226bfa7d387bd325d80d865d483b7_r.jpg" alt></p>
<p>其中的掩码主要是为了实现快速取余的用途，它的大小为 <code>size-1</code>，在 <code>Redis</code> 中，桶的数量一定是 $2^n$ 个，那么给定一个哈希值 $hash$ 可以使用 $hash & sizemask$ 来得到该数据落在哪一个哈希桶中。</p>
<p>接下来来看看字典类型特定函数，在 <code>src/dic.h</code> 中，定义了一个结构体，里面存储着一系列函数指针，这些对应了基础的哈希操作，看博客说这是函数式编程的思想，然而我并没有上过这课。。。</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dictType</span> {</span></span><br><span class="line">    <span class="hljs-keyword">uint64_t</span> (*hashFunction)(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *key);            <span class="hljs-comment">//通给可定key，计算对应的哈希值</span></span><br><span class="line">    <span class="hljs-keyword">void</span> *(*keyDup)(<span class="hljs-keyword">void</span> *privdata, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *key);     <span class="hljs-comment">//用于复制key的函数指针</span></span><br><span class="line">    <span class="hljs-keyword">void</span> *(*valDup)(<span class="hljs-keyword">void</span> *privdata, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *obj);     <span class="hljs-comment">//用于复制value的函数指针</span></span><br><span class="line">    <span class="hljs-keyword">int</span> (*keyCompare)(<span class="hljs-keyword">void</span> *privdata, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *key1, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *key2); <span class="hljs-comment">//两个key的比较函数</span></span><br><span class="line">    <span class="hljs-keyword">void</span> (*keyDestructor)(<span class="hljs-keyword">void</span> *privdata, <span class="hljs-keyword">void</span> *key);     <span class="hljs-comment">//用于处理key的释放</span></span><br><span class="line">    <span class="hljs-keyword">void</span> (*valDestructor)(<span class="hljs-keyword">void</span> *privdata, <span class="hljs-keyword">void</span> *obj);     <span class="hljs-comment">//用于处理val的释放</span></span><br><span class="line">} dictType;</span><br></pre></td></tr></tbody></table></figure>

<p>在 <code>src/server.c</code> 中，<code>Redis</code> 为不同类型的哈希表给出了不同的 <code>dictType</code>，例如：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/* Db->dict, key是sds动态字符串, vals则是Redis对象类型 */</span></span><br><span class="line">dictType dbDictType = {</span><br><span class="line">    dictSdsHash,                <span class="hljs-comment">/* hash function */</span></span><br><span class="line">    <span class="hljs-literal">NULL</span>,                       <span class="hljs-comment">/* key dup */</span></span><br><span class="line">    <span class="hljs-literal">NULL</span>,                       <span class="hljs-comment">/* val dup */</span></span><br><span class="line">    dictSdsKeyCompare,          <span class="hljs-comment">/* key compare */</span></span><br><span class="line">    dictSdsDestructor,          <span class="hljs-comment">/* key destructor */</span></span><br><span class="line">    dictObjectDestructor        <span class="hljs-comment">/* val destructor */</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>有了 <code>dictht</code> 和 <code>dictType</code>，我们可以确定最终的字典结构了：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dict</span> {</span></span><br><span class="line">    dictType *type;</span><br><span class="line">    <span class="hljs-keyword">void</span> *privdata;</span><br><span class="line">    dictht ht[<span class="hljs-number">2</span>];</span><br><span class="line">    <span class="hljs-keyword">long</span> rehashidx; <span class="hljs-comment">/* rehashing not in progress if rehashidx == -1 */</span></span><br><span class="line">    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> iterators; <span class="hljs-comment">/* number of iterators currently running */</span></span><br><span class="line">} dict;</span><br></pre></td></tr></tbody></table></figure>

<p>字典在内存中的结构如下：</p>
<p>图源：<img src="https://pic3.zhimg.com/v2-593acbfb3c20cc86fe6bd132c52372be_r.jpg" alt></p>
<p>在 <code>Redis</code> 中，每一个字典有两个 <code>dictht</code>，这是为了实现 <strong>渐进式 rehash</strong></p>
<p>这个概念我也不明白，看看《Redis 设计与实现》的说法吧：</p>
<h3 id="rehash"><a href="#rehash" class="headerlink" title="rehash"></a>rehash</h3><p>随着操作的不断执行，哈希表保存的键值对会逐渐地增多或减少，为了让哈希表的负载因子维持在一个合理的范围之内，当哈希表保存的键值对数量太多或太少时，程序需要对哈希表的大小进行相应的扩展或者收缩。</p>
<p><code>Redis</code> 对字典的哈希表执行 <code>rehash</code> 的步骤如下：</p>
<ul>
<li>为字典的 <code>ht[1]</code> 分配空间，这个哈希表的大小取决于要执行的操作，以及 <code>ht[0]</code> 当前包含的键值对数量（即 <code>ht[0].used</code>）：<ul>
<li>如果执行扩展操作，那么 <code>ht[1]</code> 的大小为第一个大于等于 <code>ht[0].used * 2</code> 的 $2^n$。</li>
<li>如果执行收缩操作，那么 <code>ht[1]</code> 的大小为第一个大于等于 <code>ht[0].used</code> 的 $2^n$。</li>
</ul>
</li>
<li>将保存在 <code>ht[0]</code> 中的所有键值对 <code>rehash</code> 到 <code>ht[1]</code> 上面：<code>rehash</code> 指的是重新计算键的哈希值和索引值，然后将键值对放到 <code>ht[1]</code> 哈希表的指定位置上。</li>
<li>当 <code>ht[0]</code> 包含的所有键值对都迁移到了 <code>ht[1]</code> 之后，释放 <code>ht[0]</code>，将 <code>ht[1]</code> 设置为 <code>ht[0]</code>，并在 <code>ht[1]</code> 新创建一个空表，为下一次 <code>rehash</code> 做准备。</li>
</ul>
<p>接下来看看什么是渐进式 <code>rehash</code> 吧：</p>
<p>扩展或收缩哈希表需要将 <code>ht[0]</code> 里面的所有键值对 <code>rehash</code> 到 <code>ht[1]</code> 里面， 但是， 这个 <code>rehash</code> 动作并不是一次性、集中式地完成的， 而是分多次、渐进式地完成的。</p>
<p>这样做的原因在于， 如果 <code>ht[0]</code> 里只保存着四个键值对， 那么服务器可以在瞬间就将这些键值对全部 <code>rehash</code> 到 <code>ht[1]</code> ； 但是， 如果哈希表里保存的键值对数量不是四个， 而是四百万、四千万甚至四亿个键值对， 那么要一次性将这些键值对全部 <code>rehash</code> 到 <code>ht[1]</code> 的话， 庞大的计算量可能会导致服务器在一段时间内停止服务。</p>
<p>因此， 为了避免 <code>rehash</code> 对服务器性能造成影响， 服务器不是一次性将 <code>ht[0]</code> 里面的所有键值对全部 <code>rehash</code> 到 <code>ht[1]</code> ， 而是分多次、渐进式地将 <code>ht[0]</code> 里面的键值对慢慢地 <code>rehash</code> 到 <code>ht[1]</code> </p>
<p>过程如下：</p>
<ul>
<li>为 <code>ht[1]</code> 分配空间， 让字典同时持有 <code>ht[0]</code> 和 <code>ht[1]</code> 两个哈希表。</li>
<li>在字典中维持一个索引计数器变量 <code>rehashidx</code> ， 并将它的值设置为 <code>0</code> ， 表示 <code>rehash</code> 工作正式开始。</li>
<li>在 <code>rehash</code> 进行期间， 每次对字典执行添加、删除、查找或者更新操作时， 程序除了执行指定的操作以外， 还会顺带将 <code>ht[0]</code> 哈希表在 <code>rehashidx</code> 索引上的所有键值对 <code>rehash</code> 到 <code>ht[1]</code> ， 当 <code>rehash</code> 工作完成之后， 程序将 <code>rehashidx</code> 属性的值增一。</li>
<li>随着字典操作的不断执行， 最终在某个时间点上， <code>ht[0]</code> 的所有键值对都会被 <code>rehash</code> 至 <code>ht[1]</code> ， 这时程序将 <code>rehashidx</code> 属性的值设为 <code>-1</code> ， 表示 <code>rehash</code> 操作已完成。</li>
</ul>
<h2 id="基础底层操作"><a href="#基础底层操作" class="headerlink" title="基础底层操作"></a>基础底层操作</h2><figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 使用 dictType 中的 valDestructor 来释放 entry 节点 val 值</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictFreeVal(d, entry) \</span></span><br><span class="line">    <span class="hljs-keyword">if</span> ((d)->type->valDestructor) \</span><br><span class="line">        (d)->type->valDestructor((d)->privdata, (entry)->v.val)</span><br><span class="line"><span class="hljs-comment">// 为 val 赋值</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictSetVal(d, entry, _val_) do { \</span></span><br><span class="line">    <span class="hljs-keyword">if</span> ((d)->type->valDup) \</span><br><span class="line">        (entry)->v.val = (d)->type->valDup((d)->privdata, _val_); \</span><br><span class="line">    <span class="hljs-keyword">else</span> \</span><br><span class="line">        (entry)->v.val = (_val_); \</span><br><span class="line">} <span class="hljs-keyword">while</span>(<span class="hljs-number">0</span>)</span><br><span class="line"><span class="hljs-comment">// 为 v.s64 赋值</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictSetSignedIntegerVal(entry, _val_) \</span></span><br><span class="line">    <span class="hljs-keyword">do</span> { (entry)->v.s64 = _val_; } <span class="hljs-keyword">while</span>(<span class="hljs-number">0</span>)</span><br><span class="line"><span class="hljs-comment">// 为 v.u64 赋值</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictSetUnsignedIntegerVal(entry, _val_) \</span></span><br><span class="line">    <span class="hljs-keyword">do</span> { (entry)->v.u64 = _val_; } <span class="hljs-keyword">while</span>(<span class="hljs-number">0</span>)</span><br><span class="line"><span class="hljs-comment">// 为 v.d 赋值</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictSetDoubleVal(entry, _val_) \</span></span><br><span class="line">    <span class="hljs-keyword">do</span> { (entry)->v.d = _val_; } <span class="hljs-keyword">while</span>(<span class="hljs-number">0</span>)</span><br><span class="line"><span class="hljs-comment">// 使用 dict 中 type 的 valDestructor 来释放 entry 节点的key</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictFreeKey(d, entry) \</span></span><br><span class="line">    <span class="hljs-keyword">if</span> ((d)->type->keyDestructor) \</span><br><span class="line">        (d)->type->keyDestructor((d)->privdata, (entry)->key)</span><br><span class="line"><span class="hljs-comment">// 为 entry 中的 key 赋值</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictSetKey(d, entry, _key_) do { \</span></span><br><span class="line">    <span class="hljs-keyword">if</span> ((d)->type->keyDup) \</span><br><span class="line">        (entry)->key = (d)->type->keyDup((d)->privdata, _key_); \</span><br><span class="line">    <span class="hljs-keyword">else</span> \</span><br><span class="line">        (entry)->key = (_key_); \</span><br><span class="line">} <span class="hljs-keyword">while</span>(<span class="hljs-number">0</span>)</span><br><span class="line"><span class="hljs-comment">// 对两个 key 进行比较</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictCompareKeys(d, key1, key2) \</span></span><br><span class="line">    (((d)->type->keyCompare) ? \</span><br><span class="line">        (d)->type->keyCompare((d)->privdata, key1, key2) : \</span><br><span class="line">        (key1) == (key2))</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictHashKey(d, key) (d)->type->hashFunction(key)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictGetKey(he) ((he)->key)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictGetVal(he) ((he)->v.val)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictGetSignedIntegerVal(he) ((he)->v.s64)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictGetUnsignedIntegerVal(he) ((he)->v.u64)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictGetDoubleVal(he) ((he)->v.d)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictSlots(d) ((d)->ht[0].size+(d)->ht[1].size)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictSize(d) ((d)->ht[0].used+(d)->ht[1].used)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dictIsRehashing(d) ((d)->rehashidx != -1)</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>构建以及初始化</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> _dictReset(dictht *ht)</span><br><span class="line">{</span><br><span class="line">    ht->table = <span class="hljs-literal">NULL</span>;</span><br><span class="line">    ht->size = <span class="hljs-number">0</span>;</span><br><span class="line">    ht->sizemask = <span class="hljs-number">0</span>;</span><br><span class="line">    ht->used = <span class="hljs-number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="hljs-function">dict *<span class="hljs-title">dictCreate</span><span class="hljs-params">(dictType *type,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        <span class="hljs-keyword">void</span> *privDataPtr)</span></span></span><br><span class="line"><span class="hljs-function"></span>{</span><br><span class="line">    dict *d = zmalloc(<span class="hljs-keyword">sizeof</span>(*d));</span><br><span class="line"></span><br><span class="line">    _dictInit(d,type,privDataPtr);</span><br><span class="line">    <span class="hljs-keyword">return</span> d;</span><br><span class="line">}</span><br><span class="line"><span class="hljs-keyword">int</span> _dictInit(dict *d, dictType *type,</span><br><span class="line">        <span class="hljs-keyword">void</span> *privDataPtr)</span><br><span class="line">{</span><br><span class="line">    _dictReset(&d->ht[<span class="hljs-number">0</span>]);</span><br><span class="line">    _dictReset(&d->ht[<span class="hljs-number">1</span>]);</span><br><span class="line">    d->type = type;</span><br><span class="line">    d->privdata = privDataPtr;</span><br><span class="line">    d->rehashidx = <span class="hljs-number">-1</span>;</span><br><span class="line">    d->iterators = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">return</span> DICT_OK;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>这三个函数不难看懂，第一个用来对给定的 <code>dictht</code> 进行重置，第三个使用一个给定的 <code>dictType</code> 以及一个私有数据指针 <code>privDataPtr</code> 来初始化一个 <code>dictht</code>。第二个是创建函数，调用 <code>zmalloc</code> 函数来分配一个 <code>dict</code>，并进行初始化。</p>
<p>析构：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dictRelease</span><span class="hljs-params">(dict *d)</span></span>;</span><br><span class="line"><span class="hljs-keyword">int</span> _dictClear(dict *d, dictht *ht, <span class="hljs-keyword">void</span>(callback)(<span class="hljs-keyword">void</span> *));</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dictEmpty</span><span class="hljs-params">(dict* d, <span class="hljs-keyword">void</span>(callbacl)(<span class="hljs-keyword">void</span>*))</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<p><code>_dictClear</code> 是整个的关键，<code>dictRelease</code> 和 <code>dictEmpty</code> 的区别在于是否释放掉哈希表，前者会释放而后者只是清除元素，我们重点来关注一下 <code>_dictClear</code> 函数：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">int</span> _dictClear(dict *d, dictht *ht, <span class="hljs-keyword">void</span>(callback)(<span class="hljs-keyword">void</span> *)) {</span><br><span class="line">    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/* Free all the elements */</span></span><br><span class="line">    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i < ht->size && ht->used > <span class="hljs-number">0</span>; i++) {</span><br><span class="line">        dictEntry *he, *nextHe;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (callback && (i & <span class="hljs-number">65535</span>) == <span class="hljs-number">0</span>) callback(d->privdata);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> ((he = ht->table[i]) == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">continue</span>;</span><br><span class="line">        <span class="hljs-keyword">while</span>(he) {</span><br><span class="line">            nextHe = he->next;</span><br><span class="line">            dictFreeKey(d, he);</span><br><span class="line">            dictFreeVal(d, he);</span><br><span class="line">            zfree(he);</span><br><span class="line">            ht->used--;</span><br><span class="line">            he = nextHe;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-comment">/* Free the table and the allocated cache structure */</span></span><br><span class="line">    zfree(ht->table);</span><br><span class="line">    <span class="hljs-comment">/* Re-initialize the table */</span></span><br><span class="line">    _dictReset(ht);</span><br><span class="line">    <span class="hljs-keyword">return</span> DICT_OK; <span class="hljs-comment">/* never fails */</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>我们可以看到，他传入了一个回调函数，那么每清空 $65536$ 个桶时，会调用这个回调函数，对此，作者给出的理由是：</p>
<p><code>dict.c: added optional callback to dictEmpty().Redis hash table implementation has many non-blocking fearures like incremental rehashing, however while deleting a large hash table there was no way to have a callback called to do some incremental work.This commit adds this support, as an optiona callback argument to dictEmtpy() that is currently called at a fixed interval (one time every 65k deletions)</code></p>
<p>好吧，看的不是很懂，翻译过来是：在 <code>Redis</code> 的哈希表操作很多的是以非阻塞的方式进行的，但是释放与清空的操作却是 以阻塞的方式进行的，当删除一个很大的哈希表时，缺少一种增量逐步执行某些操作的机制。 因此，作者在这次提交中引入了这个机制，可以在删除哈希表时，以一个固定的间隔来执行回调函数。</p>
<p>好吧我还是不明白，这里借用一下知乎一篇文章举的例子：</p>
<p><img src alt></p>
</body></html>
        </div>
        
        
        
    </div>
</div>









    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2021-02-09T07:25:07.000Z">2021-02-09</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/artical/">artical</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    17 minutes read (About 2554 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2021/02/09/Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9Astring/">Redis数据类型：string</a>
            
        </h1>
        <div class="content">
            <html><head></head><body><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>寒假在家无聊，就想着看看 <code>Redis5.0</code> 的源码，刚好在知乎也看见一个写的不错的笔记，就顺着它的学习路线看代码了</p>
<h2 id="Redis-是什么？"><a href="#Redis-是什么？" class="headerlink" title="Redis 是什么？"></a><code>Redis</code> 是什么？</h2><p><code>Redis</code> 是一个使用 <code>ANSI C</code> 编写的开源、支持网络、基于内存、分布式、可持久性的键值对存储数据库（wiki 百科）。</p>
<h2 id="Redis-支持哪些数据类型？"><a href="#Redis-支持哪些数据类型？" class="headerlink" title="Redis 支持哪些数据类型？"></a><code>Redis</code> 支持哪些数据类型？</h2><ul>
<li>字符串</li>
<li>字符串列表</li>
<li>无序不重复的字符串集合</li>
<li>有序不重复的字符串集合</li>
<li>键、值都为字符串的哈希表</li>
</ul>
<h2 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h2><p><code>Redis</code> 一般将全部的数据都存储在内存中，目前通过两种方法实现持久化：</p>
<ul>
<li>快照，一种半持久内用模式。不时地将数据集以异步的方式从内存以 <code>RDB</code> 格式写入硬盘。</li>
<li>1.1 版本开始使用更安全的 <code>AOF</code> 格式替代，一种只能追加的日志类型。将数据集修改操作记录起来。<code>Redis</code> 能够在后台对只可追加的记录作修改来避免无限增长的日志</li>
</ul>
<h2 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h2><p><code>Redis</code> 支持主从同步。数据可以从主服务器向任意数量的服务器上同步，从服务器可以使关联其他从服务器的主服务器，这使得 <code>Redis</code> 可执行单层树复制。从盘可以有意无意的对数据进行写操作。由于完全实现了发布/订阅机制，使得从数据库在任何地方同步树时，可订阅一个频道并接收主服务器完整的消息发布记录。同步对读取操作的可扩展性和数据冗余很有帮助。（讲道理这些我现在也不是很懂。。。）</p>
<h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2><p>当数据依赖不再需要，Redis这种基于内存的性质，与在执行一个事务时将每个变化都写入硬盘的数据库系统相比就显得执行效率非常高。写与读操作速度没有明显差别</p>
<h2 id="Redis-中的-string-——-sdshdr"><a href="#Redis-中的-string-——-sdshdr" class="headerlink" title="Redis 中的 string —— sdshdr"></a>Redis 中的 string —— sdshdr</h2><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p><code>Redis5.0</code> 中定义了五种 <code>string</code> 类型：</p>
<ul>
<li>sdshdr5</li>
<li>sdshdr8</li>
<li>sdshdr16</li>
<li>sdshdr32</li>
<li>sdshdr64</li>
</ul>
<p>没错，后面的数字后缀代表了能存储的字符串的最大长度。我们先来看后面四种，他们都具有相同的结构：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> __<span class="hljs-title">attribute__</span> ((__<span class="hljs-title">packed__</span>)) <span class="hljs-title">sdshdr8</span> {</span></span><br><span class="line">    <span class="hljs-keyword">uint8_t</span> len;            <span class="hljs-comment">// 已使用长度</span></span><br><span class="line">    <span class="hljs-keyword">uint8_t</span> alloc;          <span class="hljs-comment">// 总的大小</span></span><br><span class="line">    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> flags;    <span class="hljs-comment">// 第三位记录类型，高五位无用处</span></span><br><span class="line">    <span class="hljs-keyword">char</span> buf[];             <span class="hljs-comment">// 实际字符缓存</span></span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>所以，<code>sdshdr</code> 类型的结构图如下：</p>
<p><img src="https://gitee.com/lengpi/blog/blob/master/Redis-string/1.png" alt></p>
<p>图源：<img src="https://www.zhihu.com/column/c_1231226679504166912" alt></p>
<p>也就是说，<code>sdshdr</code> 在内存中的格式为一个 <code>Header</code> 字段加上一段连续内存。<code>sds</code> 就是实际字符串的第一个字节。</p>
<p>由于只有 5 种类型，所以用一个 <code>unsigned char</code> 类型足够描述该种 <code>sdshdr</code> 类型，<code>Redis</code> 中定义了几种 type:</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDS_TYPE_5  0</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDS_TYPE_8  1</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDS_TYPE_16 2</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDS_TYPE_32 3</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDS_TYPE_64 4</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDS_TYPE_MASK 7</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDS_TYPE_BITS 3</span></span><br></pre></td></tr></tbody></table></figure>

<p>显然，通过 <code>flags</code> 字段与 <code>SDS_TYPE_MASK</code> 做位与运算，我们可以得到其类型，而由于结构体使用的是非对齐类型（<code>__attribute__ ((__packed__))</code>），所以，我们直接通过访问 <code>s[-1]</code> 即可获得其头部信息。（讲道理我看到这个也傻了，这不是 <code>runtime error</code> 吗？但是转头一想，里面的数字不过是个偏移量罢了，只要你访问的那段内存是有效的，又怎么会产生段错误呢？）</p>
<p>现在我们来看看 <code>sdshdr5</code> 吧，他的结构如下：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> __<span class="hljs-title">attribute__</span> ((__<span class="hljs-title">packed__</span>)) <span class="hljs-title">sdshdr5</span></span></span><br><span class="line"><span class="hljs-class">{</span></span><br><span class="line">    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> flags; <span class="hljs-comment">/* 3 lsb of type, and 5 msb of string length */</span></span><br><span class="line">    <span class="hljs-keyword">char</span> buf[];</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>这样看上去，好像 <code>sdshdr5</code> 就是为了那些较短的字符串（不超过 32 个字节）准备的吧，像是一种静态的类型。对此，<code>Redis</code> 的作者也给出了建议：</p>
<p><code>Don't use TYPE 5 if strings are going to be reallocated, since it sucks not having a free space left field.</code></p>
<p>（谁会给 32 个字节的东西重新分配大小呢？）</p>
<h3 id="通用底层操作"><a href="#通用底层操作" class="headerlink" title="通用底层操作"></a>通用底层操作</h3><p>在源码中，我们可以看到许多的宏定义：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDS_HDR(T,s) ((struct sdshdr##T *)((s)-(sizeof(struct sdshdr##T))))</span></span><br></pre></td></tr></tbody></table></figure>

<p>讲道理 <code>struct sdshdr##T</code> 是啥意思我真不明白，也没找到，我们结合使用了这个宏定义的函数来看看：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">size_t</span> <span class="hljs-title">sdslen</span><span class="hljs-params">(<span class="hljs-keyword">const</span> sds s)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> flags = s[<span class="hljs-number">-1</span>];</span><br><span class="line">    <span class="hljs-keyword">switch</span>(flags&SDS_TYPE_MASK) {</span><br><span class="line">        <span class="hljs-keyword">case</span> SDS_TYPE_5:</span><br><span class="line">            <span class="hljs-keyword">return</span> SDS_TYPE_5_LEN(flags);</span><br><span class="line">        <span class="hljs-keyword">case</span> SDS_TYPE_8:</span><br><span class="line">            <span class="hljs-keyword">return</span> SDS_HDR(<span class="hljs-number">8</span>,s)->len;</span><br><span class="line">        <span class="hljs-keyword">case</span> SDS_TYPE_16:</span><br><span class="line">            <span class="hljs-keyword">return</span> SDS_HDR(<span class="hljs-number">16</span>,s)->len;</span><br><span class="line">        <span class="hljs-keyword">case</span> SDS_TYPE_32:</span><br><span class="line">            <span class="hljs-keyword">return</span> SDS_HDR(<span class="hljs-number">32</span>,s)->len;</span><br><span class="line">        <span class="hljs-keyword">case</span> SDS_TYPE_64:</span><br><span class="line">            <span class="hljs-keyword">return</span> SDS_HDR(<span class="hljs-number">64</span>,s)->len;</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>从名字不难得出，这就是返回 <code>string</code> 长度的，也就是 <code>Header</code> 中的 <code>len</code> 字段，注意传递进来的 <code>sds</code> 就是 <code>char *</code> 。</p>
<p>很明显，我们需要通过传递进来的 <code>sds</code> 数据得到对应的 <code>Header</code> 指针，这样我们才能访问 <code>len</code> 字段，那上面的式子就好理解了啊！<code>##T</code> 应该是被替换成了相应的数字，很巧妙的设计！因为结构体中的 <code>char buf[]</code> 是不占内存的，这样我们就直接访问到了 <code>Header</code> 的第一个字节，后面代码中很多地方都巧妙地利用了这一点。</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SDS_HDR_VAR(T,s) struct sdshdr##T *sh = (void*)((s)-(sizeof(struct sdshdr##T)));</span></span><br></pre></td></tr></tbody></table></figure>

<p>这一句相比也很明白了，定义了一个全局变量 <code>sh</code>，他能指向对应字符串的 <code>Header</code> 字段的第一个字节。</p>
<p>接下来就是一些字面意思的函数了：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">size_t</span> <span class="hljs-title">sdsavail</span><span class="hljs-params">(<span class="hljs-keyword">const</span> sds s)</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>计算还有多少可用空间</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sdssetlen</span><span class="hljs-params">(sds s, <span class="hljs-keyword">size_t</span> newlen)</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>设置新长度</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sdsinclen</span><span class="hljs-params">(sds s, <span class="hljs-keyword">size_t</span> inc)</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>增加长度</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">size_t</span> <span class="hljs-title">sdsalloc</span><span class="hljs-params">(<span class="hljs-keyword">const</span> sds s)</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>得到总空间</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sdssetalloc</span><span class="hljs-params">(sds s, <span class="hljs-keyword">size_t</span> newlen)</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>重置总空间</p>
<h3 id="各种操作函数"><a href="#各种操作函数" class="headerlink" title="各种操作函数"></a>各种操作函数</h3><figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">char</span> <span class="hljs-title">sdsReqType</span><span class="hljs-params">(<span class="hljs-keyword">size_t</span> string_size)</span></span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">sdsHdrSzie</span><span class="hljs-params">(<span class="hljs-keyword">char</span> type)</span></span>;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-keyword">size_t</span> <span class="hljs-title">sdsTypeMaxSize</span><span class="hljs-params">(<span class="hljs-keyword">char</span> type)</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>这是位与 <code>src/sds.c</code> 中的两个静态函数，分别用于返回一个特定 <code>HeaderType</code>的头部结构体长度、根据一个 <code>string_size</code> 的长度，返回合适的 <code>HeaderType</code>、以及根据 <code>type</code> 返回最大容量。</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sds _sdsnewlen(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *init, <span class="hljs-keyword">size_t</span> initlen, <span class="hljs-keyword">int</span> trymalloc);</span><br></pre></td></tr></tbody></table></figure>

<p>这是根据给定的 <code>init</code> 指针和 <code>initlen</code> 长度 来创建一个 <code>sds</code> 的函数，他的实现还是比较复杂的，具体描述如下：</p>
<p>我们根据给定的长度返回一个 <code>HeaderType</code>，比如：5，8，16，32 或者 64，然后对一个 <code>void *</code> 类型的变量进行初始化，长度为 <code>initlen+hdrlen+1</code>，加一是有讲究的，因为在 <code>Redis</code> 中 <code>sds</code> 总是以 <code>'\0'</code> 作为结尾的，所以需要多分配一个字节的内存，哪有的小伙伴就有疑问了，要是数据中出现了 <code>'\0'</code> 怎么办？这点完全不用担心，因为我们有 <code>len</code> 字段啊。之后我们会初始化 <code>Header</code> 中的各个字段，并将 <code>init</code> 中的内容拷贝到 <code>sds</code> 的缓冲区，以 <code>'\0'</code> 结尾。</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">sds <span class="hljs-title">sdsnewlen</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *init, <span class="hljs-keyword">size_t</span> initlen)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">return</span> _sdsnewlen(init, initlen, <span class="hljs-number">0</span>);</span><br><span class="line">}</span><br><span class="line"><span class="hljs-function">sds <span class="hljs-title">sdstrynewlen</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *init, <span class="hljs-keyword">size_t</span> initlen)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">return</span> _sdsnewlen(init, initlen, <span class="hljs-number">1</span>);</span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">/* Create an empty (zero length) sds string. Even in this case the string</span></span><br><span class="line"><span class="hljs-comment"> * always has an implicit null term. */</span></span><br><span class="line"><span class="hljs-function">sds <span class="hljs-title">sdsempty</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">return</span> sdsnewlen(<span class="hljs-string">""</span>,<span class="hljs-number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/* Create a new sds string starting from a null terminated C string. */</span></span><br><span class="line"><span class="hljs-function">sds <span class="hljs-title">sdsnew</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *init)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">size_t</span> initlen = (init == <span class="hljs-literal">NULL</span>) ? <span class="hljs-number">0</span> : <span class="hljs-built_in">strlen</span>(init);</span><br><span class="line">    <span class="hljs-keyword">return</span> sdsnewlen(init, initlen);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/* Duplicate an sds string. */</span></span><br><span class="line"><span class="hljs-function">sds <span class="hljs-title">sdsdup</span><span class="hljs-params">(<span class="hljs-keyword">const</span> sds s)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">return</span> sdsnewlen(s, sdslen(s));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这些函数都很简单，对着上面看就 ok 了，但是有关内存分配我其实并没有讲，这一块确实比较大，我打算以后单独拎出来。</p>
<p>接下来我们看以个比较有意思的函数</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">sds <span class="hljs-title">sdsMakeRoomFor</span><span class="hljs-params">(sds s, <span class="hljs-keyword">size_t</span> addlen)</span></span>;</span><br></pre></td></tr></tbody></table></figure>

<p>这个接口用于给一个给定的字符串扩容，可以确保用户在调用这个接口之后，可以向缓存之中续写 <code>addlen</code> 个字节的内容，但是这个操作不会改变已经使用的缓存的大小，也就是不会改变 <code>sdslen</code> 调用的结果。这个函数有点儿复杂，我就不讲码德直接上代码了。。。</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function">sds <span class="hljs-title">sdsMakeRoomFor</span><span class="hljs-params">(sds s, <span class="hljs-keyword">size_t</span> addlen)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">void</span> *sh, *newsh;</span><br><span class="line">    <span class="hljs-comment">// 计算剩余空间</span></span><br><span class="line">    <span class="hljs-keyword">size_t</span> avail = sdsavail(s);</span><br><span class="line">    <span class="hljs-keyword">size_t</span> len, newlen;</span><br><span class="line">    <span class="hljs-keyword">char</span> type, oldtype = s[<span class="hljs-number">-1</span>] & SDS_TYPE_MASK;</span><br><span class="line">    <span class="hljs-keyword">int</span> hdrlen;</span><br><span class="line">    <span class="hljs-keyword">size_t</span> usable;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/* 如果剩余空间足够的话，就原封不动返回 */</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (avail >= addlen) <span class="hljs-keyword">return</span> s;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 参数字符串长度</span></span><br><span class="line">    len = sdslen(s);</span><br><span class="line">    <span class="hljs-comment">// 获取 Header 指针</span></span><br><span class="line">    sh = (<span class="hljs-keyword">char</span>*)s-sdsHdrSize(oldtype);</span><br><span class="line">    newlen = (len+addlen);</span><br><span class="line">    <span class="hljs-comment">// 这里的目的是减少多次扩容带来开销，索性一次给多点，1024 * 1024，也就是 1MB</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (newlen < SDS_MAX_PREALLOC)</span><br><span class="line">        newlen *= <span class="hljs-number">2</span>;</span><br><span class="line">    <span class="hljs-keyword">else</span></span><br><span class="line">        newlen += SDS_MAX_PREALLOC;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 获得新类型</span></span><br><span class="line">    type = sdsReqType(newlen);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 提示好好看，就是别用 sdshdr5</span></span><br><span class="line">    <span class="hljs-comment">/* Don't use type 5: the user is appending to the string and type 5 is</span></span><br><span class="line"><span class="hljs-comment">     * not able to remember empty space, so sdsMakeRoomFor() must be called</span></span><br><span class="line"><span class="hljs-comment">     * at every appending operation. */</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (type == SDS_TYPE_5) type = SDS_TYPE_8;</span><br><span class="line"></span><br><span class="line">    hdrlen = sdsHdrSize(type);</span><br><span class="line">    <span class="hljs-comment">// 没有引发升级</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (oldtype==type) {</span><br><span class="line">        newsh = s_realloc_usable(sh, hdrlen+newlen+<span class="hljs-number">1</span>, &usable);</span><br><span class="line">        <span class="hljs-keyword">if</span> (newsh == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;</span><br><span class="line">        s = (<span class="hljs-keyword">char</span>*)newsh+hdrlen;</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        <span class="hljs-comment">// 升级了的话会构造一个新的 sds</span></span><br><span class="line">        <span class="hljs-comment">/* Since the header size changes, need to move the string forward,</span></span><br><span class="line"><span class="hljs-comment">         * and can't use realloc */</span></span><br><span class="line">        newsh = s_malloc_usable(hdrlen+newlen+<span class="hljs-number">1</span>, &usable);</span><br><span class="line">        <span class="hljs-keyword">if</span> (newsh == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;</span><br><span class="line">        <span class="hljs-built_in">memcpy</span>((<span class="hljs-keyword">char</span>*)newsh+hdrlen, s, len+<span class="hljs-number">1</span>);</span><br><span class="line">        s_free(sh);</span><br><span class="line">        s = (<span class="hljs-keyword">char</span>*)newsh+hdrlen;</span><br><span class="line">        s[<span class="hljs-number">-1</span>] = type;</span><br><span class="line">        sdssetlen(s, len);</span><br><span class="line">    }</span><br><span class="line">    usable = usable-hdrlen<span class="hljs-number">-1</span>;</span><br><span class="line">    <span class="hljs-keyword">if</span> (usable > sdsTypeMaxSize(type))</span><br><span class="line">        usable = sdsTypeMaxSize(type);</span><br><span class="line">    sdssetalloc(s, usable);</span><br><span class="line">    <span class="hljs-keyword">return</span> s;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>尤其是最后一点，升级将会导致分配一个新的 <code>sds</code>，然后返回新的指针，这也就意味着调用者无法保证作为参数传入的 <code>sds</code> 指针在调用结束后是否有效，对此，作者给出了建议：</p>
<p><code>Don't call sdsMakeRoomFor() when obviously not needed.</code></p>
<p>剩下的就是处理内容的函数了，这些我就自个儿慢慢看了（或者咕掉），都不是很复杂，类似于 C 中的一些处理函数，只不过要注意处理 <code>Header</code> 字段。</p>
</body></html>
        </div>
        
        
        
    </div>
</div>









    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2021-01-28T09:20:19.000Z">2021-01-28</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Distributed-Systems/">Distributed Systems</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a few seconds read (About 0 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2021/01/28/MapReduce/">MapReduce</a>
            
        </h1>
        <div class="content">
            
        </div>
        
        
        
    </div>
</div>









    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-10-15T15:15:37.000Z">2020-10-15</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/LeetCode/">LeetCode</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 513 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/10/15/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D/">正则表达式匹配</a>
            
        </h1>
        <div class="content">
            <html><head></head><body><h2 id="题意：给你一个字符串-s-和一个字符规律-p，请你实现一个支持-39-39-和-39-39-的正则表达式匹配。"><a href="#题意：给你一个字符串-s-和一个字符规律-p，请你实现一个支持-39-39-和-39-39-的正则表达式匹配。" class="headerlink" title="题意：给你一个字符串 s 和一个字符规律 p，请你实现一个支持 '.' 和 '*' 的正则表达式匹配。"></a>题意：给你一个字符串 <code>s</code> 和一个字符规律 <code>p</code>，请你实现一个支持 <code>'.'</code> 和 <code>'*'</code> 的正则表达式匹配。</h2><figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">'.'</span> 匹配任意单个字符</span><br><span class="line"><span class="hljs-string">'*'</span> 匹配零个或多个前面的那一个元素</span><br></pre></td></tr></tbody></table></figure>

<p>所谓匹配，是要涵盖整个字符串 <code>s</code> 的，而不是部分字符串。</p>
<p><strong>样例</strong>：</p>
<figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">s = <span class="hljs-string">"aab"</span></span><br><span class="line">p = <span class="hljs-string">"c*a*b"</span></span><br><span class="line">输出 ：<span class="hljs-literal">true</span></span><br><span class="line">解释 ： 因为 <span class="hljs-string">'*'</span> 表示零个或多个，这里 <span class="hljs-string">'c'</span> 为 <span class="hljs-number">0</span> 个, <span class="hljs-string">'a'</span> 被重复一次。因此可以匹配字符串 <span class="hljs-string">"aab"</span>。</span><br></pre></td></tr></tbody></table></figure>

<h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>很明显这道题属于动归吧？状态其实很好表示：<code>dp[i][j]</code> 表示 <code>s</code> 的前 <code>i</code> 个字符和 <code>p</code> 的前 <code>j</code> 个字符的匹配情况，转移方程的关键在于 <code>s[i]</code> 和 <code>p[j]</code>。尤其要注意 <code>.</code> 和 <code>*</code> 字符。</p>
<ul>
<li><p>当 <code>s[i] == p[j] || p[j] == '.'</code> 时，<code>dp[i][j] = dp[i-1][j-1</code>；</p>
</li>
<li><p>当 <code>p[j] == '*</code> 时，情况就显得比较复杂了:</p>
<ul>
<li>当 <code>s[i] != p[j-1] && p[j-1] != '.</code> 时，意味着 <code>s</code> 的前 <code>i</code> 个字符与 <code>p</code> 的前 <code>j</code> 和前 <code>j-1</code> 个字符都是不能匹配的（因为末尾不相等），所以 <code>dp[i][j] = dp[i][j-2]</code>；</li>
<li>否则，就把最后的 <code>p[j-1],p[j]</code> 来进行分类讨论，由于 <code>*</code> 代表重复 $0$ 到多次，所以这时候就很明显了，要么 $0$，次，要么多次；$0$ 次的时候：<code>dp[i][j] = dp[i][j-2]</code>，多次的时候：<code>dp[i][j] = dp[i-1][j]</code>。这二者是或的关系。</li>
</ul>
</li>
</ul>
<h2 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h2><ul>
<li>空串的情况。</li>
<li>初始化 <code>dp[0][0] = 1</code>。</li>
<li>解决空串比较好的一个方法是在 <code>s</code> 和 <code>p</code> 前都加一个 <code>""</code>。</li>
</ul>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight cpp hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> {</span></span><br><span class="line"><span class="hljs-keyword">public</span>:</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isMatch</span><span class="hljs-params">(<span class="hljs-built_in">string</span> s, <span class="hljs-built_in">string</span> p)</span> </span>{</span><br><span class="line">        s = <span class="hljs-string">" "</span>+s;</span><br><span class="line">        p = <span class="hljs-string">" "</span>+p;</span><br><span class="line">        <span class="hljs-keyword">int</span> n = s.size(), m = p.size();</span><br><span class="line">        <span class="hljs-keyword">int</span> dp[n+<span class="hljs-number">1</span>][m+<span class="hljs-number">1</span>];</span><br><span class="line">        <span class="hljs-built_in">memset</span>(dp, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(dp));</span><br><span class="line">        dp[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;</span><br><span class="line">        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i <= n; ++i) {</span><br><span class="line">            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j <= m; ++j) {</span><br><span class="line">                <span class="hljs-keyword">if</span>(p[j<span class="hljs-number">-1</span>] == s[i<span class="hljs-number">-1</span>] || p[j<span class="hljs-number">-1</span>] == <span class="hljs-string">'.'</span>) dp[i][j] = dp[i<span class="hljs-number">-1</span>][j<span class="hljs-number">-1</span>];</span><br><span class="line">                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(p[j<span class="hljs-number">-1</span>] == <span class="hljs-string">'*'</span>) </span><br><span class="line">                    <span class="hljs-keyword">if</span>(s[i<span class="hljs-number">-1</span>] != p[j<span class="hljs-number">-2</span>] && p[j<span class="hljs-number">-2</span>] != <span class="hljs-string">'.'</span>) dp[i][j] = dp[i][j<span class="hljs-number">-2</span>];</span><br><span class="line">                    <span class="hljs-keyword">else</span> dp[i][j] = dp[i][j<span class="hljs-number">-2</span>] | dp[i<span class="hljs-number">-1</span>][j];</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">return</span> dp[n][m];</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

</body></html>
        </div>
        
        
        
    </div>
</div>









    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-09-17T10:47:59.000Z">2020-09-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Client/">Client</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 minutes read (About 742 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/09/17/electron-ipcMain-md/">electron-ipcMain.md</a>
            
        </h1>
        <div class="content">
            <html><head></head><body><h2 id="ipcMain"><a href="#ipcMain" class="headerlink" title="ipcMain"></a>ipcMain</h2><p>从主进程到渲染进程的异步通信。当在主进程中使用时，它处理从渲染进程（网页）发送出来的异步和同步信息。从渲染器进程发送的消息将发送到该模块。</p>
<h3 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h3><p>也可以从主进程向渲染进程发送消息。</p>
<ul>
<li>发送消息，事件名称为 <code>channel</code></li>
<li>回复同步信息时，需要设置  <code>event.returnValue</code></li>
<li>可以使用 <code>event.sender.send()</code> 将异步消息发回发送者。</li>
</ul>
<p>例子：</p>
<figure class="highlight js hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 主进程</span></span><br><span class="line"><span class="hljs-keyword">const</span> { ipcMain } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'electron'</span>)</span><br><span class="line">ipcMain.on(<span class="hljs-string">'asynchronous-message'</span>, (event, arg) => {</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(arg)</span><br><span class="line">    event.reply(<span class="hljs-string">'asynchronous-reply'</span>, <span class="hljs-string">'pong'</span>)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">ipcMain.on(<span class="hljs-string">'synchronous-message'</span>, (event, arg) => {</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(arg)</span><br><span class="line">    event.returnValue = <span class="hljs-string">'pong'</span></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight js hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 渲染进程</span></span><br><span class="line"><span class="hljs-keyword">const</span> { ipaRenderer } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'electron'</span>)</span><br><span class="line"><span class="hljs-built_in">console</span>.log(ipcRenderer.sendSync(<span class="hljs-string">'synchronous-message'</span>, <span class="hljs-string">'ping'</span>))</span><br><span class="line"></span><br><span class="line">ipcRenderer.on(<span class="hljs-string">'asynchronous-reply'</span>, (event, arg) => {</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(arg)</span><br><span class="line">})</span><br><span class="line">ipcRenderer.send(<span class="hljs-string">'asynchronous-message'</span>, <span class="hljs-string">'ping'</span>)</span><br></pre></td></tr></tbody></table></figure>



<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><h4 id="ipcMain-on-channel-listener"><a href="#ipcMain-on-channel-listener" class="headerlink" title="ipcMain.on(channel, listener)"></a><code>ipcMain.on(channel, listener)</code></h4><ul>
<li><code>channel</code> String</li>
<li><code>listener</code> Function<ul>
<li><code>event</code> IpcMainEvent</li>
<li><code>...args</code> any[]</li>
</ul>
</li>
</ul>
<p>监听 <code>channel</code>，当接收到新的消息时 <code>listener</code> 会以 <code>listener(event, args)</code> 的形式被调用。</p>
<h4 id="ipcMain-once-channel-listener"><a href="#ipcMain-once-channel-listener" class="headerlink" title="ipcMain.once(channel, listener)"></a><code>ipcMain.once(channel, listener)</code></h4><ul>
<li><code>channel</code> String</li>
<li><code>listener</code> Function<ul>
<li><code>event</code> IpcMainEvent</li>
<li><code>...args</code> any[]</li>
</ul>
</li>
</ul>
<p>为事件添加一次监听器功能，仅在下次将消息发送到通道时才调用此侦听器，然后将其删除。</p>
<h4 id="ipcMain-removeListener-channel-listener"><a href="#ipcMain-removeListener-channel-listener" class="headerlink" title="ipcMain.removeListener(channel, listener)"></a><code>ipcMain.removeListener(channel, listener)</code></h4><ul>
<li><code>channel</code> String</li>
<li><code>listener</code> Function<ul>
<li><code>...args</code> any[]</li>
</ul>
</li>
</ul>
<p>从监听器数组中移除监听 <code>channel</code> 的指定 <code>listener</code> 。</p>
<h4 id="ipcMain-removeAllListeners-channel"><a href="#ipcMain-removeAllListeners-channel" class="headerlink" title="ipcMain.removeAllListeners([channel])"></a><code>ipcMain.removeAllListeners([channel])</code></h4><ul>
<li><code>channel</code> String (optional)</li>
</ul>
<p>删除所有监听者，或指定的 <code>channel</code> 的所有监听者。</p>
<h4 id="ipcMain-handle-channel-listener"><a href="#ipcMain-handle-channel-listener" class="headerlink" title="ipcMain.handle(channel, listener)"></a><code>ipcMain.handle(channel, listener)</code></h4><ul>
<li><code>channel</code> String</li>
<li><code>listener</code> Function<Promise|any><ul>
<li><code>event</code>  IpcMainInvokeEvent</li>
<li><code>...args</code>  any[]</li>
</ul>
</li>
</ul>
<p>为可调用的 IPC 添加处理程序。每当渲染器程序调用 <code>ipcRenderer.invoke(channel, ...args)</code> 都会调用这个处理程序。</p>
<p>如果 <code>listener</code>  返回一个 <code>Promise</code>  ，则 <code>Promise</code> 的最终结果将作为对远程调用者的答复而返回。否则，<code>listener</code>  的返回值将用作回复的值。</p>
<figure class="highlight js hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// Main process</span></span><br><span class="line">ipcMain.handle(<span class="hljs-string">'my-invokable-ipc'</span>, <span class="hljs-keyword">async</span> (event, ...args) => {</span><br><span class="line">  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> somePromise(...args)</span><br><span class="line">  <span class="hljs-keyword">return</span> result</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// Renderer process</span></span><br><span class="line"><span class="hljs-keyword">async</span> () => {</span><br><span class="line">  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> ipcRenderer.invoke(<span class="hljs-string">'my-invokable-ipc'</span>, arg1, arg2)</span><br><span class="line">  <span class="hljs-comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>作为第一个参数传递给处理程序的事件与传递给常规事件侦听器的事件相同，它包含有关哪些 <code>WebContents</code>  是调用请求源的信息。</p>
<h4 id="ipcMain-handleOnce-channel-listener"><a href="#ipcMain-handleOnce-channel-listener" class="headerlink" title="ipcMain.handleOnce(channel, listener)"></a><code>ipcMain.handleOnce(channel, listener)</code></h4><ul>
<li><code>channel</code>  String</li>
<li><code>listener</code> Function<Promise|any><ul>
<li><code>event</code>  IpcMainInvokeEvent</li>
<li><code>...args</code>  any[]</li>
</ul>
</li>
</ul>
<p>处理单个可调用的 IPC 消息，然后删除侦听器</p>
<h4 id="ipcMain-removeHandler-channel"><a href="#ipcMain-removeHandler-channel" class="headerlink" title="ipcMain.removeHandler(channel)"></a><code>ipcMain.removeHandler(channel)</code></h4><ul>
<li><code>channel</code>  String</li>
</ul>
<p>为 <code>channel</code>  删除所有处理程序。</p>
<h4 id="ipcMainEvent-Object-extends-Event"><a href="#ipcMainEvent-Object-extends-Event" class="headerlink" title="ipcMainEvent Object extends Event"></a>ipcMainEvent Object extends <code>Event</code></h4><ul>
<li><code>frameID</code>  Integer -  发送该消息的渲染进程框架的 ID</li>
<li><code>returnValue</code>  any - 将其设置为要在同步消息中返回的值</li>
<li><code>sender</code>  WebContents - 返回发送消息的  WebContents</li>
<li><code>ports</code>  MessagePortMain[] - 随着消息一起传送的 MessagePort 列表</li>
<li><code>reply</code>  Function - 将 IPC 消息发送到渲染器框架的函数，该渲染器框架发送当前正在处理的原始消息，你应该使用 <code>reply</code>  方法回复发送的消息，以确保回复将转到正确的进程和框架。<ul>
<li><code>channel</code>  String</li>
<li><code>...args</code>  any[]</li>
</ul>
</li>
</ul>
<h4 id="ipcRendererEvent-对象继承-Event"><a href="#ipcRendererEvent-对象继承-Event" class="headerlink" title="ipcRendererEvent  对象继承 Event"></a><code>ipcRendererEvent</code>  对象继承 <code>Event</code></h4><ul>
<li><p><code>frameID</code>  Integer -  发送该消息的渲染进程框架的 ID</p>
</li>
<li><p>WebContents - 返回发送消息的  WebContents</p>
</li>
</ul>
</body></html>
        </div>
        
        
        
    </div>
</div>









    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-09-15T08:37:30.000Z">2020-09-15</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Web/">Web</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 minutes read (About 1002 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/09/15/%E5%B5%8C%E5%A5%97%E5%87%BD%E6%95%B0%E5%92%8C%E9%97%AD%E5%8C%85/">嵌套函数和闭包</a>
            
        </h1>
        <div class="content">
            <html><head></head><body><p>在 JS 中，可以在一个函数中嵌套另一个函数，内部函数对外部函数是私有的。它自身也形成了一个闭包，这意味着它自身可以拥有独立的环境与变量表达式。</p>
<p>一个嵌套（内部）函数可以“继承”容器（外部）函数的参数和变量，也就是说，内部函数包含外部函数的作用域。</p>
<ul>
<li>内部函数只能在外部函数中访问</li>
<li>内部函数形成了一个闭包：他可以访问外部函数的参数和变量，但外部函数却不能使用它的变量和参数。</li>
</ul>
<figure class="highlight js hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addSquares</span>(<span class="hljs-params">a, b</span>) </span>{</span><br><span class="line">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">square</span>(<span class="hljs-params">x</span>) </span>{</span><br><span class="line">    <span class="hljs-keyword">return</span> x * x;</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">return</span> square(a) + square(b);</span><br><span class="line">}</span><br><span class="line">a = addSquares(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// returns 13</span></span><br><span class="line">b = addSquares(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>); <span class="hljs-comment">// returns 25</span></span><br><span class="line">c = addSquares(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">// returns 41</span></span><br></pre></td></tr></tbody></table></figure>

<p>由于内部函数形成了闭包，因此你可以调用外部函数并为外部函数和内部函数指定参数</p>
<figure class="highlight js hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">outside</span>(<span class="hljs-params">x</span>) </span>{</span><br><span class="line">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inside</span>(<span class="hljs-params">y</span>) </span>{</span><br><span class="line">    <span class="hljs-keyword">return</span> x + y;</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">return</span> inside;</span><br><span class="line">}</span><br><span class="line">fn_inside = outside(<span class="hljs-number">3</span>); <span class="hljs-comment">// 可以这样想：给一个函数，使它的值加3，fn_inside 成为了一个函数</span></span><br><span class="line"><span class="hljs-built_in">console</span>.log(fn_inside);</span><br><span class="line"></span><br><span class="line">result = fn_inside(<span class="hljs-number">5</span>); <span class="hljs-comment">// returns 8</span></span><br><span class="line"></span><br><span class="line">result1 = outside(<span class="hljs-number">3</span>)(<span class="hljs-number">5</span>); <span class="hljs-comment">// returns 8</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-built_in">console</span>.log(result);</span><br></pre></td></tr></tbody></table></figure>

<h2 id="保存变量"><a href="#保存变量" class="headerlink" title="保存变量"></a>保存变量</h2><p>一个闭包必须保存它可见作用域中所有参数和变量。因为每一次调用传入的参数都可能不同，每一次对外部函数的调用实际上重新创建了一遍这个闭包，只有当返回的 <code>inside</code> 没有再次被引用时，内存才会释放。</p>
<h2 id="多层嵌套函数"><a href="#多层嵌套函数" class="headerlink" title="多层嵌套函数"></a>多层嵌套函数</h2><p>函数可以被多层嵌套，因此，闭包可以包含多个作用域；他们递归式的包含了所有包含它的函数作用域，这个称之为作用域链。</p>
<figure class="highlight js hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">A</span>(<span class="hljs-params">x</span>) </span>{</span><br><span class="line">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">B</span>(<span class="hljs-params">y</span>) </span>{</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(<span class="hljs-number">111</span>);</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">C</span>(<span class="hljs-params">z</span>) </span>{</span><br><span class="line">      <span class="hljs-built_in">console</span>.log(x + y + z);</span><br><span class="line">    }</span><br><span class="line">    C(<span class="hljs-number">3</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">333</span>);</span><br><span class="line">  B(<span class="hljs-number">2</span>);</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">222</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">A(<span class="hljs-number">1</span>); <span class="hljs-comment">// logs 6 (1 + 2 + 3)</span></span><br></pre></td></tr></tbody></table></figure>

<p>输出结果：</p>
<figure class="highlight js hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-number">333</span></span><br><span class="line"><span class="hljs-number">111</span></span><br><span class="line"><span class="hljs-number">6</span></span><br><span class="line"><span class="hljs-number">222</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="命名冲突"><a href="#命名冲突" class="headerlink" title="命名冲突"></a>命名冲突</h2><p>当同一个闭包作用域下两个参数或者变量同名时，就会产生命名冲突。更近的作用域有更高的优先权，所以最近的优先级最高，最远的优先级最低。这就是作用域链。链的第一个元素就是最里面的作用域，最后一个元素便是最外层的作用域。</p>
<figure class="highlight js hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">outside</span>(<span class="hljs-params"></span>) </span>{</span><br><span class="line">  <span class="hljs-keyword">var</span> x = <span class="hljs-number">5</span>;</span><br><span class="line">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inside</span>(<span class="hljs-params">x</span>) </span>{</span><br><span class="line">    <span class="hljs-keyword">return</span> x * <span class="hljs-number">2</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-keyword">return</span> inside;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">outside()(<span class="hljs-number">10</span>); <span class="hljs-comment">// returns 20 instead of 10</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h1><p>闭包是 JavaScript 最强大的特性之一。当内部函数的生存周期大于外部函数时，外部函数中的定义的变量和函数的生存周期将比内部函数执行时间长。当内部函数以某一种方式被任何一个外部函数作用域访问时，一个闭包就产生了。</p>
<figure class="highlight js hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> pet = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{          <span class="hljs-comment">//外部函数定义了一个变量"name"</span></span><br><span class="line">  <span class="hljs-keyword">var</span> getName = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{            </span><br><span class="line">    <span class="hljs-comment">//内部函数可以访问 外部函数定义的"name"</span></span><br><span class="line">    <span class="hljs-keyword">return</span> name; </span><br><span class="line">  }</span><br><span class="line">  <span class="hljs-comment">//返回这个内部函数，从而将其暴露在外部函数作用域</span></span><br><span class="line">  <span class="hljs-keyword">return</span> getName;               </span><br><span class="line">};</span><br><span class="line">myPet = pet(<span class="hljs-string">"Vivie"</span>);</span><br><span class="line">    </span><br><span class="line">myPet();                            <span class="hljs-comment">// 返回结果 "Vivie"</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="使用-arguments-对象"><a href="#使用-arguments-对象" class="headerlink" title="使用 arguments 对象"></a>使用 arguments 对象</h1><p>函数的实际参数会被保存在一个类似数组的 arguments 对象中。</p>
<p>使用 arguments 对象，你可以处理比声明的更多的参数来调用函数。这在你事先不知道会需要将多少参数传递给函数时十分有用。</p>
<p>例如下面这个链接字符串的函数</p>
<figure class="highlight js hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myConcat</span>(<span class="hljs-params">separator</span>) </span>{</span><br><span class="line">   <span class="hljs-keyword">var</span> result = <span class="hljs-string">''</span>; <span class="hljs-comment">// 把值初始化成一个字符串，这样就可以用来保存字符串了！！</span></span><br><span class="line">   <span class="hljs-keyword">var</span> i;</span><br><span class="line">   <span class="hljs-comment">// iterate through arguments</span></span><br><span class="line">   <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i < <span class="hljs-built_in">arguments</span>.length; i++) {</span><br><span class="line">      result += <span class="hljs-built_in">arguments</span>[i] + separator;</span><br><span class="line">   }</span><br><span class="line">   <span class="hljs-keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"><span class="hljs-comment">// returns "red, orange, blue, "</span></span><br><span class="line">myConcat(<span class="hljs-string">", "</span>, <span class="hljs-string">"red"</span>, <span class="hljs-string">"orange"</span>, <span class="hljs-string">"blue"</span>);</span><br></pre></td></tr></tbody></table></figure>

<h1 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h1><h2 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h2><p>在 JavaScript 中，函数参数的默认值是 <code>undefined</code>。</p>
<h2 id="剩余参数"><a href="#剩余参数" class="headerlink" title="剩余参数"></a>剩余参数</h2><p>剩余参数语法允许将不确定的参数表示为数组</p>
<figure class="highlight js hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">multiply</span>(<span class="hljs-params">multiplier, ...theArgs</span>) </span>{</span><br><span class="line">  <span class="hljs-keyword">return</span> theArgs.map(<span class="hljs-function"><span class="hljs-params">x</span> =></span> multiplier * x);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> arr = multiply(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);</span><br><span class="line"><span class="hljs-built_in">console</span>.log(arr); <span class="hljs-comment">// [2, 4, 6]</span></span><br></pre></td></tr></tbody></table></figure>
</body></html>
        </div>
        
        
        
    </div>
</div>









    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-09-05T14:53:33.000Z">2020-09-05</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a minute read (About 173 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/09/05/UML-Lec06/">UML-Lec06</a>
            
        </h1>
        <div class="content">
            <html><head></head><body><h2 id="公共机制"><a href="#公共机制" class="headerlink" title="公共机制"></a>公共机制</h2><ul>
<li>修饰<ul>
<li>注释</li>
<li>可见性、角色、多重性</li>
</ul>
</li>
<li>扩充机制<ul>
<li>构造型</li>
<li>标记值</li>
<li>约束</li>
</ul>
</li>
<li>规格说明</li>
<li>公用划分</li>
</ul>
<h3 id="扩充机制"><a href="#扩充机制" class="headerlink" title="扩充机制"></a>扩充机制</h3><h4 id="构造型"><a href="#构造型" class="headerlink" title="构造型"></a>构造型</h4><p>类似于已有的 UML 建模元素<br>又是对特定问题领域具有特殊含义的新的建模元素</p>
<h4 id="标记值"><a href="#标记值" class="headerlink" title="标记值"></a>标记值</h4><p>在建模过程中，</p>
<p>出于某种原因需要增加一个新的构成以表达建模元素的某种特性，用花括号括起来</p>
<h4 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h4><p>为对应的建模元素规定了一个条件，用花括号括起来</p>
<h3 id="类的扩充机制"><a href="#类的扩充机制" class="headerlink" title="类的扩充机制"></a>类的扩充机制</h3><ul>
<li>控制类</li>
<li>边界类</li>
<li>实体类</li>
</ul>
<p>他们都是类的构造型</p>
</body></html>
        </div>
        
        
        
    </div>
</div>









    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-09-05T14:43:58.000Z">2020-09-05</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 minutes read (About 228 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/09/05/UML-Lec05/">UML-Lec05</a>
            
        </h1>
        <div class="content">
            <html><head></head><body><h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><p>类的定义：具有相同属性、相同行为的一组对象的描述符，是真实世界事物的抽象</p>
<h3 id="类的表示–责职"><a href="#类的表示–责职" class="headerlink" title="类的表示–责职"></a>类的表示–责职</h3><ul>
<li>是类的合约或责任</li>
<li>一个良好定义的类应该有清晰的职责</li>
<li>一个类应只承担一种职责</li>
<li>类的职责划分的好坏，决定了设计方案的内聚性及耦合性</li>
</ul>
<h3 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h3><ul>
<li>依赖关系：说明一个事物使用另一个事物的信息和服务</li>
<li>泛化关系：子类和父类之间</li>
<li>关联关系<ul>
<li>关联关系的修饰<ul>
<li>名称及其方向</li>
<li>角色：在关联的每一端，表明和相连的类在该关联关系中的作用</li>
<li>多重性聚合/组合<ul>
<li>聚合：整体有管理部分的特有的职责，空菱形</li>
<li>组合：整体有部分的生命，实菱形</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</body></html>
        </div>
        
        
        
    </div>
</div>









    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-09-05T14:32:36.000Z">2020-09-05</time>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    a minute read (About 114 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/09/05/UML-Lec03/">UML-Lec03</a>
            
        </h1>
        <div class="content">
            <html><head></head><body><h2 id="四种关系"><a href="#四种关系" class="headerlink" title="四种关系"></a>四种关系</h2><ul>
<li><p>关联关系</p>
<ul>
<li>实线+无箭头</li>
</ul>
</li>
<li><p>依赖关系</p>
<ul>
<li>箭头指向被依赖的一方</li>
<li>虚线+叉箭头</li>
</ul>
</li>
<li><p>继承关系（泛化关系）</p>
<ul>
<li>实线+空心箭头</li>
</ul>
</li>
<li><p>实现关系</p>
<ul>
<li>虚线+空心箭头</li>
</ul>
</li>
<li><p>参与者与参与者</p>
<ul>
<li>泛化关系</li>
</ul>
</li>
<li><p>参与者与用例</p>
<ul>
<li>关联关系</li>
</ul>
</li>
<li><p>用例与用例</p>
<ul>
<li>泛化关系</li>
<li>包含关系：基用例指向子用例</li>
<li>扩展关系：子用例指向基用例</li>
</ul>
</li>
</ul>
</body></html>
        </div>
        
        
        
    </div>
</div>










    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/page/0/">Previous</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/2/">Next</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="" src="/images/avatar.jpg" alt="lengpi">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        lengpi
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        student
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Shanghai, China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <p class="title has-text-weight-normal">
                        18
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <p class="title has-text-weight-normal">
                        9
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <p class="title has-text-weight-normal">
                        8
                    </p>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/zzpzbl" target="_blank">
                Follow</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/zzpzbl">
                
                <i class="fab fa-github"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://github.com/ppoffice" target="_blank">
                    <span class="level-left">
                        <span class="level-item">PPOffice</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">github.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/ACM/">
            <span class="level-start">
                <span class="level-item">ACM</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/C/">
            <span class="level-start">
                <span class="level-item">C++</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Client/">
            <span class="level-start">
                <span class="level-item">Client</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Distributed-Systems/">
            <span class="level-start">
                <span class="level-item">Distributed Systems</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Essay/">
            <span class="level-start">
                <span class="level-item">Essay</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/LeetCode/">
            <span class="level-start">
                <span class="level-item">LeetCode</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/UML/">
            <span class="level-start">
                <span class="level-item">UML</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Web/">
            <span class="level-start">
                <span class="level-item">Web</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/artical/">
            <span class="level-start">
                <span class="level-item">artical</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/Algorithm/" style="font-size: 20px;">Algorithm</a> <a href="/tags/C/" style="font-size: 10px;">C++</a> <a href="/tags/Dynamic-programming/" style="font-size: 10px;">Dynamic programming</a> <a href="/tags/Environment-configuration/" style="font-size: 10px;">Environment configuration</a> <a href="/tags/JS/" style="font-size: 10px;">JS</a> <a href="/tags/MapReduce/" style="font-size: 10px;">MapReduce</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/electron/" style="font-size: 10px;">electron</a>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2021/11/21/Gotw1/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Gotw1">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-11-21T13:29:07.000Z">2021-11-21</time></div>
                    <a href="/2021/11/21/Gotw1/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Gotw1</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/C/">C++</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/02/10/Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9Amap/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Redis数据类型：map">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-02-10T05:50:31.000Z">2021-02-10</time></div>
                    <a href="/2021/02/10/Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9Amap/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Redis数据类型：map</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/artical/">artical</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/02/09/Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9Astring/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Redis数据类型：string">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-02-09T07:25:07.000Z">2021-02-09</time></div>
                    <a href="/2021/02/09/Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9Astring/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Redis数据类型：string</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/artical/">artical</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/01/28/MapReduce/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="MapReduce">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-01-28T09:20:19.000Z">2021-01-28</time></div>
                    <a href="/2021/01/28/MapReduce/" class="title has-link-black-ter is-size-6 has-text-weight-normal">MapReduce</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Distributed-Systems/">Distributed Systems</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/10/15/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="正则表达式匹配">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-10-15T15:15:37.000Z">2020-10-15</time></div>
                    <a href="/2020/10/15/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D/" class="title has-link-black-ter is-size-6 has-text-weight-normal">正则表达式匹配</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/LeetCode/">LeetCode</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/11/">
                <span class="level-start">
                    <span class="level-item">November 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/02/">
                <span class="level-start">
                    <span class="level-item">February 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/01/">
                <span class="level-start">
                    <span class="level-item">January 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/10/">
                <span class="level-start">
                    <span class="level-item">October 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/09/">
                <span class="level-start">
                    <span class="level-item">September 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">July 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/06/">
                <span class="level-start">
                    <span class="level-item">June 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Algorithm/">
                        <span class="tag">Algorithm</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/C/">
                        <span class="tag">C++</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Dynamic-programming/">
                        <span class="tag">Dynamic programming</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Environment-configuration/">
                        <span class="tag">Environment configuration</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JS/">
                        <span class="tag">JS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MapReduce/">
                        <span class="tag">MapReduce</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Redis/">
                        <span class="tag">Redis</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/electron/">
                        <span class="tag">electron</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>


                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/2021/11/21/Gotw1/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Gotw1">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-11-21T13:29:07.000Z">2021-11-21</time></div>
                    <a href="/2021/11/21/Gotw1/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Gotw1</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/C/">C++</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/02/10/Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9Amap/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Redis数据类型：map">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-02-10T05:50:31.000Z">2021-02-10</time></div>
                    <a href="/2021/02/10/Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9Amap/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Redis数据类型：map</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/artical/">artical</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/02/09/Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9Astring/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Redis数据类型：string">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-02-09T07:25:07.000Z">2021-02-09</time></div>
                    <a href="/2021/02/09/Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%9Astring/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Redis数据类型：string</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/artical/">artical</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/01/28/MapReduce/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="MapReduce">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-01-28T09:20:19.000Z">2021-01-28</time></div>
                    <a href="/2021/01/28/MapReduce/" class="title has-link-black-ter is-size-6 has-text-weight-normal">MapReduce</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Distributed-Systems/">Distributed Systems</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/10/15/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="正则表达式匹配">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-10-15T15:15:37.000Z">2020-10-15</time></div>
                    <a href="/2020/10/15/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D/" class="title has-link-black-ter is-size-6 has-text-weight-normal">正则表达式匹配</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/LeetCode/">LeetCode</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/11/">
                <span class="level-start">
                    <span class="level-item">November 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/02/">
                <span class="level-start">
                    <span class="level-item">February 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/01/">
                <span class="level-start">
                    <span class="level-item">January 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/10/">
                <span class="level-start">
                    <span class="level-item">October 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/09/">
                <span class="level-start">
                    <span class="level-item">September 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">July 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/06/">
                <span class="level-start">
                    <span class="level-item">June 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Algorithm/">
                        <span class="tag">Algorithm</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/C/">
                        <span class="tag">C++</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Dynamic-programming/">
                        <span class="tag">Dynamic programming</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Environment-configuration/">
                        <span class="tag">Environment configuration</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JS/">
                        <span class="tag">JS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MapReduce/">
                        <span class="tag">MapReduce</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Redis/">
                        <span class="tag">Redis</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/electron/">
                        <span class="tag">electron</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>


            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.jpg" alt="Hexo" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2021 John Doe&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/zzpzbl">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
<script src="/js/animation.js"></script>

    
    
<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>

    
    
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="noopener">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>

    
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>
    
    
<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>

    
    
    
    
    
    
    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>
